tags:
  - name: Transaction
    description: Transaction-related endpoints

paths:
  /transactions:
    post:
      tags:
        - Transaction
      summary: Get transactions list
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/XApiEncrypt'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                filters:
                  type: object
                  description: Optional filters for transactions
                page:
                  type: integer
                  example: 1
                limit:
                  type: integer
                  example: 20
      responses:
        '200':
          description: Transactions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  transactions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error

  /transactions/{id}:
    get:
      tags:
        - Transaction
      summary: Get transaction by ID
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/XApiEncrypt'
        - $ref: '#/components/parameters/TransactionId'
      responses:
        '200':
          description: Transaction retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '404':
          description: Transaction not found
        '401':
          description: Unauthorized

  /transactions/deposits/new:
    post:
      tags:
        - Transaction
      summary: Create deposit transaction
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/XApiEncrypt'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDepositRequest'
      responses:
        '201':
          description: Deposit transaction created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error

  /transactions/withdrawals/new:
    post:
      tags:
        - Transaction
      summary: Create withdrawal transaction
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/XApiEncrypt'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWithdrawalRequest'
      responses:
        '201':
          description: Withdrawal transaction created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error

  /transactions/transfer/new:
    post:
      tags:
        - Transaction
      summary: Create transfer
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/XApiEncrypt'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransferRequest'
      responses:
        '201':
          description: Transfer created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transfer'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error

components:
  schemas:
    Transaction:
      type: object
      properties:
        id:
          type: string
          example: "12378478"
        amount:
          type: number
          format: float
          example: 100.00
        psp:
          type: integer
          example: 1
        status:
          type: string
          enum: [pending, approved, rejected, completed]
          example: "approved"
        type:
          type: string
          enum: [deposit, withdrawal, transfer]
          example: "deposit"
        manager:
          type: integer
          example: 1
        sid:
          type: integer
          example: 5
        login:
          type: string
          example: "87043829"
        currency:
          type: string
          example: "USD"
        mt4Comment:
          type: string
          nullable: true
          example: null
        comment:
          type: string
          example: "Transaction comment"
        vendorTransactionId:
          type: string
          nullable: true
          example: "VND-123456"
        customFields:
          type: object
          additionalProperties: true
          example:
            custom_field_1: "Hello!"
            custom_field_2: "Bonjour!"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    CreateDepositRequest:
      type: object
      required:
        - amount
        - psp
        - status
        - manager
        - sid
        - login
        - currency
      properties:
        amount:
          type: number
          format: float
          example: 100
          description: Deposit amount
        psp:
          type: integer
          example: 1
          description: Payment service provider ID
        status:
          type: string
          enum: [pending, approved, rejected]
          example: "approved"
          description: Transaction status
        manager:
          type: integer
          example: 1
          description: Manager ID
        sid:
          type: integer
          example: 5
          description: Server ID
        login:
          type: string
          example: "87043829"
          description: Trading account login
        currency:
          type: string
          example: "USD"
          description: Currency code
        mt4Comment:
          type: string
          nullable: true
          example: null
          description: MT4 platform comment
        comment:
          type: string
          example: "Deposit comment"
          description: Transaction comment
        customFields:
          type: object
          additionalProperties: true
          example:
            custom_field_1: "Hello!"
            custom_field_2: "Bonjour!"
          description: Custom fields for additional data

    CreateWithdrawalRequest:
      type: object
      required:
        - amount
        - psp
        - status
        - type
        - manager
        - sid
        - login
        - currency
      properties:
        amount:
          type: number
          format: float
          example: 50
          description: Withdrawal amount
        skipNegativeBalanceCheck:
          type: boolean
          example: false
          description: Skip negative balance validation
        psp:
          type: integer
          example: 1
          description: Payment service provider ID
        vendorTransactionId:
          type: string
          example: "VND-123456"
          description: Vendor transaction identifier
        status:
          type: string
          enum: [pending, approved, rejected]
          example: "approved"
          description: Transaction status
        type:
          type: string
          enum: [withdrawal]
          example: "withdrawal"
          description: Transaction type
        manager:
          type: integer
          example: 1
          description: Manager ID
        sid:
          type: integer
          example: 5
          description: Server ID
        login:
          type: string
          example: "87043829"
          description: Trading account login
        currency:
          type: string
          example: "USD"
          description: Currency code
        mt4Comment:
          type: string
          nullable: true
          example: null
          description: MT4 platform comment
        comment:
          type: string
          example: "Withdrawal comment"
          description: Transaction comment
        customFields:
          type: object
          additionalProperties: true
          example:
            custom_field_1: "Hello!"
            custom_field_2: "Bonjour!"
          description: Custom fields for additional data

    CreateTransferRequest:
      type: object
      required:
        - fromSid
        - fromLogin
        - toSid
        - toLogin
        - status
        - amount
      properties:
        fromSid:
          type: string
          example: "9"
          description: Source server ID
        fromLogin:
          type: string
          example: "86032821"
          description: Source account login
        toSid:
          type: string
          example: "5"
          description: Destination server ID
        toLogin:
          type: string
          example: "87043829"
          description: Destination account login
        status:
          type: string
          enum: [pending, approved, rejected]
          example: "approved"
          description: Transfer status
        amount:
          type: number
          format: float
          example: 50
          description: Transfer amount
        comment:
          type: string
          example: "Internal Comment"
          description: Transfer comment
        type:
          type: string
          example: ""
          description: Transfer type (optional)

    Transfer:
      type: object
      properties:
        id:
          type: string
          example: "TRF-123456"
        fromSid:
          type: string
          example: "9"
        fromLogin:
          type: string
          example: "86032821"
        toSid:
          type: string
          example: "5"
        toLogin:
          type: string
          example: "87043829"
        status:
          type: string
          enum: [pending, approved, rejected, completed]
          example: "approved"
        amount:
          type: number
          format: float
          example: 50
        comment:
          type: string
          example: "Internal Comment"
        type:
          type: string
          example: ""
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

  parameters:
    XApiEncrypt:
      name: x-api-encrypt
      in: header
      schema:
        type: boolean
        default: false
        example: false
      description: Encryption flag for API requests
    
    TransactionId:
      name: id
      in: path
      required: true
      description: The identifier of the transaction
      schema:
        type: string
        example: "12378478"